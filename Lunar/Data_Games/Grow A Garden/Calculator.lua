local ItemData = {
    ["Aloe Vera"] = { baseWeight=5.5, baseValue=69000, otherStat=350 },
    ["Apple"] = { baseWeight=3, baseValue=275, otherStat=50 },
    ["Avocado"] = { baseWeight=6.5, baseValue=350, otherStat=300 },
    ["Bamboo"] = { baseWeight=4, baseValue=4000, otherStat=35 },
    ["Banana"] = { baseWeight=1.5, baseValue=1750, otherStat=100 },
    ["Beanstalk"] = { baseWeight=10, baseValue=28000, otherStat=300 },
    ["Bee Balm"] = { baseWeight=1, baseValue=18000, otherStat=200 },
    ["Bell Pepper"] = { baseWeight=8, baseValue=5500, otherStat=325 },
    ["Bendboo"] = { baseWeight=18, baseValue=155000, otherStat=275 },
    ["Blood Banana"] = { baseWeight=1.5, baseValue=6000, otherStat=200 },
    ["Blue Lollipop"] = { baseWeight=1, baseValue=50000, otherStat=65 },
    ["Blueberry"] = { baseWeight=0.2, baseValue=20, otherStat=100 },
    ["Bone Blossom"] = { baseWeight=7, baseValue=175000, otherStat=200 },
    ["Boneboo"] = { baseWeight=15, baseValue=141141, otherStat=300 },
    ["Burning Bud"] = { baseWeight=12, baseValue=70000, otherStat=500 },
    ["Cacao"] = { baseWeight=8, baseValue=12000, otherStat=250 },
    ["Cactus"] = { baseWeight=7, baseValue=3400, otherStat=100 },
    ["Candy Blossom"] = { baseWeight=3, baseValue=100000, otherStat=40 },
    ["Candy Sunflower"] = { baseWeight=1.5, baseValue=80000, otherStat=85 },
    ["Cantaloupe"] = { baseWeight=5.5, baseValue=34000, otherStat=250 },
    ["Carrot"] = { baseWeight=0.275, baseValue=20, otherStat=100 },
    ["Cauliflower"] = { baseWeight=5, baseValue=50, otherStat=150 },
    ["Celestiberry"] = { baseWeight=2, baseValue=10000, otherStat=200 },
    ["Cherry Blossom"] = { baseWeight=3, baseValue=500, otherStat=400 },
    ["Chocolate Carrot"] = { baseWeight=0.275, baseValue=11000, otherStat=100 },
    ["Coconut"] = { baseWeight=14, baseValue=400, otherStat=70 },
    ["Cocovine"] = { baseWeight=14, baseValue=66666, otherStat=275 },
    ["Corn"] = { baseWeight=2, baseValue=40, otherStat=100 },
    ["Cranberry"] = { baseWeight=1, baseValue=3500, otherStat=50 },
    ["Crimson Vine"] = { baseWeight=1, baseValue=1250, otherStat=100 },
    ["Crocus"] = { baseWeight=0.275, baseValue=30000, otherStat=150 },
    ["Cursed Fruit"] = { baseWeight=30, baseValue=25750, otherStat=200 },
    ["Daffodil"] = { baseWeight=0.2, baseValue=1000, otherStat=45 },
    ["Dandelion"] = { baseWeight=4, baseValue=50000, otherStat=300 },
    ["Delphinium"] = { baseWeight=0.3, baseValue=24000, otherStat=100 },
    ["Dragon Fruit"] = { baseWeight=12, baseValue=4750, otherStat=100 },
    ["Dragon Pepper"] = { baseWeight=6, baseValue=88888, otherStat=300 },
    ["Durian"] = { baseWeight=8, baseValue=7500, otherStat=200 },
    ["Easter Egg"] = { baseWeight=3, baseValue=2500, otherStat=20 },
    ["Eggplant"] = { baseWeight=5, baseValue=12000, otherStat=220 },
    ["Elephant Ears"] = { baseWeight=18, baseValue=77000, otherStat=500 },
    ["Ember Lily"] = { baseWeight=12, baseValue=66666, otherStat=450 },
    ["Feijoa"] = { baseWeight=10, baseValue=13000, otherStat=400 },
    ["Firefly Fern"] = { baseWeight=5, baseValue=72000, otherStat=400 },
    ["Firework Flower"] = { baseWeight=20, baseValue=151000, otherStat=450 },
    ["Fossilight"] = { baseWeight=4, baseValue=88000, otherStat=500 },
    ["Foxglove"] = { baseWeight=2, baseValue=20000, otherStat=250 },
    ["Glowshroom"] = { baseWeight=0.75, baseValue=300, otherStat=100 },
    ["Grape"] = { baseWeight=3, baseValue=7850, otherStat=200 },
    ["Green Apple"] = { baseWeight=3, baseValue=300, otherStat=200 },
    ["Guanabana"] = { baseWeight=4, baseValue=70500, otherStat=400 },
    ["Hive Fruit"] = { baseWeight=8, baseValue=62000, otherStat=300 },
    ["Honeysuckle"] = { baseWeight=12, baseValue=100000, otherStat=400 },
    ["Horned Dinoshroom"] = { baseWeight=5, baseValue=69000, otherStat=275 },
    ["Ice Cream Bean"] = { baseWeight=4, baseValue=4500, otherStat=200 },
    ["Kiwi"] = { baseWeight=5, baseValue=2750, otherStat=300 },
    ["Lavender"] = { baseWeight=0.275, baseValue=25000, otherStat=90 },
    ["Lemon"] = { baseWeight=1, baseValue=350, otherStat=50 },
    ["Liberty Lily"] = { baseWeight=6.5, baseValue=30000, otherStat=350 },
    ["Lilac"] = { baseWeight=3, baseValue=35000, otherStat=250 },
    ["Lily of the Valley"] = { baseWeight=6, baseValue=49120, otherStat=400 },
    ["Lime"] = { baseWeight=1, baseValue=1000, otherStat=125 },
    ["Loquat"] = { baseWeight=6.5, baseValue=8000, otherStat=200 },
    ["Lotus"] = { baseWeight=20, baseValue=35000, otherStat=650 },
    ["Lumira"] = { baseWeight=6, baseValue=85000, otherStat=350 },
    ["Mango"] = { baseWeight=15, baseValue=6500, otherStat=200 },
    ["Manuka Flower"] = { baseWeight=0.3, baseValue=25000, otherStat=200 },
    ["Mega Mushroom"] = { baseWeight=70, baseValue=500, otherStat=2000000 },
    ["Merica Mushroom"] = { baseWeight=30, baseValue=40000, otherStat=20 },
    ["Mint"] = { baseWeight=1, baseValue=5250, otherStat=150 },
    ["Moon Blossom"] = { baseWeight=3, baseValue=66666, otherStat=400 },
    ["Moon Mango"] = { baseWeight=15, baseValue=50000, otherStat=300 },
    ["Moon Melon"] = { baseWeight=8, baseValue=18000, otherStat=300 },
    ["Moonflower"] = { baseWeight=2, baseValue=9500, otherStat=200 },
    ["Moonglow"] = { baseWeight=7, baseValue=25000, otherStat=400 },
    ["Mushroom"] = { baseWeight=25, baseValue=151000, otherStat=220 },
    ["Nectar Thorn"] = { baseWeight=7, baseValue=44444, otherStat=350 },
    ["Nectarine"] = { baseWeight=3, baseValue=48000, otherStat=200 },
    ["Nectarshade"] = { baseWeight=0.8, baseValue=50000, otherStat=100 },
    ["Nightshade"] = { baseWeight=0.5, baseValue=3500, otherStat=100 },
    ["Noble Flower"] = { baseWeight=5, baseValue=20000, otherStat=250 },
    ["Orange Tulip"] = { baseWeight=0.05, baseValue=850, otherStat=55 },
    ["Papaya"] = { baseWeight=3, baseValue=1000, otherStat=60 },
    ["Paradise Petal"] = { baseWeight=2.75, baseValue=25000, otherStat=250 },
    ["Parasol Flower"] = { baseWeight=6, baseValue=200000, otherStat=350 },
    ["Passionfruit"] = { baseWeight=3, baseValue=3550, otherStat=40 },
    ["Peace Lily"] = { baseWeight=0.6, baseValue=24000, otherStat=100 },
    ["Peach"] = { baseWeight=2, baseValue=300, otherStat=70 },
    ["Pear"] = { baseWeight=3, baseValue=20000, otherStat=120 },
    ["Pepper"] = { baseWeight=5, baseValue=8000, otherStat=200 },
    ["Pineapple"] = { baseWeight=3, baseValue=2000, otherStat=70 },
    ["Pink Lily"] = { baseWeight=6, baseValue=65000, otherStat=400 },
    ["Pink Tulip"] = { baseWeight=0.05, baseValue=850, otherStat=55 },
    ["Pitcher Plant"] = { baseWeight=12, baseValue=52000, otherStat=275 },
    ["Prickly Pear"] = { baseWeight=7, baseValue=7000, otherStat=375 },
    ["Pumpkin"] = { baseWeight=8, baseValue=3400, otherStat=80 },
    ["Purple Cabbage"] = { baseWeight=5, baseValue=500, otherStat=70 },
    ["Purple Dahlia"] = { baseWeight=12, baseValue=75000, otherStat=400 },
    ["Rafflesia"] = { baseWeight=8, baseValue=3500, otherStat=80 },
    ["Raspberry"] = { baseWeight=0.75, baseValue=100, otherStat=70 },
    ["Red Lollipop"] = { baseWeight=4, baseValue=50000, otherStat=65 },
    ["Rose"] = { baseWeight=1, baseValue=5000, otherStat=100 },
    ["Rosy Delight"] = { baseWeight=10, baseValue=69000, otherStat=450 },
    ["Soul Fruit"] = { baseWeight=25, baseValue=7750, otherStat=200 },
    ["Starfruit"] = { baseWeight=3, baseValue=15000, otherStat=250 },
    ["Stonebite"] = { baseWeight=1, baseValue=35000, otherStat=200 },
    ["Strawberry"] = { baseWeight=0.3, baseValue=15, otherStat=100 },
    ["Succulent"] = { baseWeight=5, baseValue=25000, otherStat=175 },
    ["Sugar Apple"] = { baseWeight=9, baseValue=48000, otherStat=200 },
    ["Suncoil"] = { baseWeight=10, baseValue=80000, otherStat=400 },
    ["Sunflower"] = { baseWeight=16.5, baseValue=160000, otherStat=600 },
    ["Tomato"] = { baseWeight=0.5, baseValue=30, otherStat=100 },
    ["Traveler's Fruit"] = { baseWeight=15, baseValue=59000, otherStat=500 },
    ["Venus Fly Trap"] = { baseWeight=10, baseValue=85000, otherStat=650 },
    ["Violet Corn"] = { baseWeight=3, baseValue=50000, otherStat=250 },
    ["Watermelon"] = { baseWeight=7, baseValue=3000, otherStat=70 },
    ["White Mulberry"] = { baseWeight=3, baseValue=3000, otherStat=200 },
    ["Wild Carrot"] = { baseWeight=1.3, baseValue=25000, otherStat=100 }
}

local VariantMultipliers = {
    Normal = 1,
    Gold = 20,
    Rainbow = 50
}

local MutationMultipliers = {
    Meteoric = 125, Celestial = 120, Windstruck = 2, Fried = 8, Burnt = 4, Drenched = 5, Shocked = 100, Aurora = 90,
    Choc = 2, Bloodlit = 4, Paradisal = 100, Clay = 3, Amber = 10, Zombified = 25, HoneyGlazed = 5,
    Frozen = 10, OldAmber = 20, Verdant = 4, Sandy = 3, Moonlit = 2, AncientAmber = 50, Ceramic = 30, Pollinated = 3,
    Disco = 125, Twisted = 5, Alienlike = 100, Plasma = 5, Molten = 25, Dawnbound = 150, Cooked = 10, Chilled = 2, 
    Heavenly = 5, Wiltproof = 4, Sundried = 85, Galactic = 120, Voidtouched = 135, Wet = 2, Cloudtouched = 5
}

local function GetItemData(name)
    return ItemData[name]
end

local function GetVariantMultiplier(variant)
    return VariantMultipliers[variant] or 1
end

local function GetMutationMultiplier(plant)
    local mut = plant.Mutation or plant.Mutations
    if not mut then return 1 end
    if type(mut) == "string" then
        return MutationMultipliers[mut] or 1
    elseif type(mut) == "table" then
        local m = 1
        for _, v in ipairs(mut) do
            m = m * (MutationMultipliers[v] or 1)
        end
        return m
    end
    return 1
end

local function CalculatePlantValue(plant)
    local itemName = plant.Item_String
    local variant = plant.Variant
    local weight = plant.Weight

    if not itemName or not variant or type(weight) ~= "number" then
        return 0
    end

    local data = GetItemData(itemName)
    if not data then return 0 end
    local baseWeight = data.baseWeight
    local baseValue = data.baseValue

    local ratio = weight / baseWeight
    local clamped = math.max(0.95, math.min(ratio, 1e8))
    local variantMulti = GetVariantMultiplier(variant)
    local mutationMulti = GetMutationMultiplier(plant)
    local totalMulti = variantMulti * mutationMulti
    local finalValue = baseValue * totalMulti * (clamped * clamped)
    return math.floor(finalValue + 0.5)
end

local function CalculateWeightFromValue(plant, targetValue)
    local itemName = plant.Item_String
    local variant = plant.Variant

    if not itemName or not variant or type(targetValue) ~= "number" or targetValue <= 0 then
        return 0
    end

    local data = GetItemData(itemName)
    if not data then return 0 end
    local baseWeight = data.baseWeight
    local baseValue = data.baseValue

    local variantMulti = GetVariantMultiplier(variant)
    local mutationMulti = GetMutationMultiplier(plant)
    local totalMulti = variantMulti * mutationMulti

    local divisor = baseValue * totalMulti
    if divisor <= 0 then return 0 end
    local requiredWeight = baseWeight * math.sqrt(targetValue / divisor)
    return math.floor(requiredWeight * 1000 + 0.5) / 1000
end

return {
    CalculatePlantValue = CalculatePlantValue,
    CalculateWeightFromValue = CalculateWeightFromValue,
    ItemData = ItemData,
    VariantMultipliers = VariantMultipliers,
    MutationMultipliers = MutationMultipliers
}
